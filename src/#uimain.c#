#include <stdio.h>
#include "history.h"
#include "tokenizer.h"


int wordsMatch(char *a, char *b){
  int i = 0;
  while(a[i] != '\0' || b[i] != '\0'){
    if(a[i] != b[i])return 0;
    i++;
  }
  return(a[i] != '\0' || b[i] != '\0')?0:1;
  
}



int main(){

  char input[101];
  List *history = init_history();
  char *h_command = "history";
  char *quit = "quit";
  while(1){
    printf("> ");
    scanf(" %[^\n]", input);
    int len = 0;
    while(input[len] != '\0')
      len++;
    if(len > 100){
      printf("Input is too large\n");
      break;
    }
    add_history(history, input);
    char **token_array = tokenize(input);
    if(token_array == NULL){
      printf("Failed to tokenize input string");
      break;
    }
    if(input[0] == '!'){
      int id = 0;
      for(int i = 1; i < len; i++)
	id = id * 10 + (input[i] - 48);
      char *id_string = get_history(history, id);
      if(id_string != NULL){
	if(wordsMatch(id_string, h_command))goto p_history;
	else printf("%s\n", id_string);
      }
    } else if (wordsMatch(input,h_command))goto p_history;
    else print_tokens(token_array);
    free_tokens(token_array);z
  }
 
 p_history:
  print_history(history);

  free_history(history);
  
  return 0;
}
